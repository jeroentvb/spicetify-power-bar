var powerDbar=(()=>{var e,t,a=Object.create,o=Object.defineProperty,l=Object.getOwnPropertyDescriptor,c=Object.getOwnPropertyNames,u=Object.getPrototypeOf,d=Object.prototype.hasOwnProperty,i=(e=>"undefined"!=typeof require?require:"undefined"!=typeof Proxy?new Proxy(e,{get:(e,t)=>("undefined"!=typeof require?require:e)[t]}):e)(function(e){if("react"===e)return Spicetify.React;if("react-dom"===e)return Spicetify.ReactDOM;if("undefined"!=typeof require)return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')}),n=(e,t)=>{t=o(null!=e?a(u(e)):{},"default",!t&&e&&e.__esModule?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0});var i=o(t,"__esModule",{value:!0}),n=e,s=void 0,r=void 0;if(n&&"object"==typeof n||"function"==typeof n)for(let e of c(n))d.call(i,e)||!s&&"default"===e||o(i,e,{get:()=>n[e],enumerable:!(r=l(n,e))||r.enumerable});return i},s=(e={"node_modules/classnames/index.js"(e,t){!function(){"use strict";var a={}.hasOwnProperty;function o(){for(var e=[],t=0;t<arguments.length;t++){var i=arguments[t];if(i){var n,s=typeof i;if("string"==s||"number"==s)e.push(i);else if(Array.isArray(i))!i.length||(n=o.apply(null,i))&&e.push(n);else if("object"==s)if(i.toString===Object.prototype.toString)for(var r in i)a.call(i,r)&&i[r]&&e.push(r);else e.push(i.toString())}}return e.join(" ")}void 0!==t&&t.exports?t.exports=o.default=o:"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("classnames",[],function(){return o}):window.classNames=o}()}},function(){return t||(0,e[c(e)[0]])((t={exports:{}}).exports,t),t.exports}),r=n(i("react")),g=n(i("react-dom")),p=n(i("react")),f="object"==typeof global&&global&&global.Object===Object&&global,m="object"==typeof self&&self&&self.Object===Object&&self,h=f||m||Function("return this")(),f=h.Symbol,m=Object.prototype,y=m.hasOwnProperty,v=m.toString,b=f?f.toStringTag:void 0;var w=function(e){var t=y.call(e,b),i=e[b];try{var n=!(e[b]=void 0)}catch(e){}var s=v.call(e);return n&&(t?e[b]=i:delete e[b]),s},S=Object.prototype.toString;var x=function(e){return S.call(e)},E=f?f.toStringTag:void 0;var k=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":(E&&E in Object(e)?w:x)(e)};var C=function(e){return null!=e&&"object"==typeof e};var I=function(e){return"symbol"==typeof e||C(e)&&"[object Symbol]"==k(e)},B=/\s/;var z=function(e){for(var t=e.length;t--&&B.test(e.charAt(t)););return t},A=/^\s+/;var U=function(e){return e&&e.slice(0,z(e)+1).replace(A,"")};var _=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},R=/^[-+]0x[0-9a-f]+$/i,M=/^0b[01]+$/i,H=/^0o[0-7]+$/i,L=parseInt;var P=function(e){if("number"==typeof e)return e;if(I(e))return NaN;if(_(e)&&(t="function"==typeof e.valueOf?e.valueOf():e,e=_(t)?t+"":t),"string"!=typeof e)return 0===e?e:+e;e=U(e);var t=M.test(e);return t||H.test(e)?L(e.slice(2),t?2:8):R.test(e)?NaN:+e},N=function(){return h.Date.now()},q=Math.max,K=Math.min;var $=function(n,i,e){var s,r,a,o,l,c,u=0,d=!1,g=!1,t=!0;if("function"!=typeof n)throw new TypeError("Expected a function");function p(e){var t=s,i=r;return s=r=void 0,u=e,o=n.apply(i,t)}function f(e){var t=e-c;return void 0===c||i<=t||t<0||g&&a<=e-u}function m(){var e,t=N();if(f(t))return h(t);l=setTimeout(m,(e=i-((t=t)-c),g?K(e,a-(t-u)):e))}function h(e){return l=void 0,t&&s?p(e):(s=r=void 0,o)}function y(){var e=N(),t=f(e);if(s=arguments,r=this,c=e,t){if(void 0===l)return u=e=c,l=setTimeout(m,i),d?p(e):o;if(g)return clearTimeout(l),l=setTimeout(m,i),p(c)}return void 0===l&&(l=setTimeout(m,i)),o}return i=P(i)||0,_(e)&&(d=!!e.leading,g="maxWait"in e,a=g?q(P(e.maxWait)||0,i):a,t="trailing"in e?!!e.trailing:t),y.cancel=function(){void 0!==l&&clearTimeout(l),s=c=r=l=void(u=0)},y.flush=function(){return void 0===l?o:h(N())},y},F=n(i("react")),W=n(i("react-dom")),j="settings-module__settingsContainer___e9wxn_powerDbar",J=class{constructor(e,t,i={}){this.name=e,this.settingsId=t,this.initialSettingsFields=i,this.settingsFields=this.initialSettingsFields,this.setRerender=null,this.pushSettings=async()=>{for(Object.entries(this.settingsFields).forEach(([e,t])=>{"button"!==t.type&&void 0===this.getFieldValue(e)&&this.setFieldValue(e,t.defaultValue)});!Spicetify?.Platform?.History?.listen;)await new Promise(e=>setTimeout(e,100));this.stopHistoryListener&&this.stopHistoryListener(),this.stopHistoryListener=Spicetify.Platform.History.listen(e=>{"/preferences"===e.pathname&&this.render()}),"/preferences"===Spicetify.Platform.History.location.pathname&&await this.render()},this.rerender=()=>{this.setRerender&&this.setRerender(Math.random())},this.render=async()=>{for(;!document.getElementById("desktop.settings.selectLanguage");){if("/preferences"!==Spicetify.Platform.History.location.pathname)return;await new Promise(e=>setTimeout(e,100))}const i=document.getElementsByClassName("x-settings-container")[0];let n=Array.from(i.children).find(e=>e.id===this.settingsId);if(n)console.log(n);else{(n=document.createElement("div")).id=this.settingsId,n.className=j;let e=void 0,t=0;for(;;){try{var s=i.getElementsByClassName("x-settings-button");e=Array.from(s).find(e=>"button"===e.children[0]?.type)}catch(e){console.error('Error while finding "show advanced settings" button:',e)}if(e)break;if("/preferences"!==Spicetify.Platform.History.location.pathname)return void console.warn(`[spcr-settings] couldn't find "show advanced settings" button after ${t} tries.`);t++,console.log(`Couldn't find "show advanced settings" button. Trying again in 1000ms...`),await new Promise(e=>setTimeout(e,1e3))}i.insertBefore(n,e)}W.default.render(F.default.createElement(this.FieldsContainer,null),n)},this.addButton=(e,t,i,n,s)=>{this.settingsFields[e]={type:"button",description:t,value:i,events:{onClick:n,...s}}},this.addInput=(e,t,i,n,s)=>{this.settingsFields[e]={type:"input",description:t,defaultValue:i,events:{onChange:n,...s}}},this.addHidden=(e,t)=>{this.settingsFields[e]={type:"hidden",defaultValue:t}},this.addToggle=(e,t,i,n,s)=>{this.settingsFields[e]={type:"toggle",description:t,defaultValue:i,events:{onChange:n,...s}}},this.addDropDown=(e,t,i,n,s,r)=>{this.settingsFields[e]={type:"dropdown",description:t,defaultValue:i[n],options:i,events:{onSelect:s,...r}}},this.getFieldValue=e=>JSON.parse(Spicetify.LocalStorage.get(this.settingsId+"."+e)||"{}")?.value,this.setFieldValue=(e,t)=>{Spicetify.LocalStorage.set(this.settingsId+"."+e,JSON.stringify({value:t}))},this.FieldsContainer=()=>{var[e,t]=(0,F.useState)(0);return this.setRerender=t,F.default.createElement("div",{className:j,key:e},F.default.createElement("h2",{className:"main-shelf-title main-type-cello"},this.name),Object.entries(this.settingsFields).map(([e,t])=>F.default.createElement(this.Field,{nameId:e,field:t})))},this.Field=i=>{var e=this.settingsId+"."+i.nameId;let t;if(t="button"===i.field.type?i.field.value:this.getFieldValue(i.nameId),"hidden"===i.field.type)return F.default.createElement(F.default.Fragment,null);const[n,s]=(0,F.useState)(t),r=e=>{void 0!==e&&(s(e),this.setFieldValue(i.nameId,e))};return F.default.createElement(F.default.Fragment,null,F.default.createElement("div",{className:"main-type-mesto",style:{color:"var(--spice-subtext)"}},F.default.createElement("label",{htmlFor:e},i.field.description||"")),F.default.createElement("span",{className:"x-settings-secondColumn"},"input"===i.field.type?F.default.createElement("input",{className:"main-dropDown-dropDown",id:e,dir:"ltr",value:n,type:"text",...i.field.events,onChange:e=>{r(e.currentTarget.value);const t=i.field.events?.onChange;t&&t(e)}}):"button"===i.field.type?F.default.createElement("span",{className:""},F.default.createElement("button",{id:e,className:"main-buttons-button main-button-outlined",...i.field.events,onClick:e=>{r();const t=i.field.events?.onClick;t&&t(e)},type:"button"},n)):"toggle"===i.field.type?F.default.createElement("label",{className:"x-toggle-wrapper x-settings-secondColumn"},F.default.createElement("input",{id:e,className:"x-toggle-input",type:"checkbox",checked:n,...i.field.events,onClick:e=>{r(e.currentTarget.checked);const t=i.field.events?.onClick;t&&t(e)}}),F.default.createElement("span",{className:"x-toggle-indicatorWrapper"},F.default.createElement("span",{className:"x-toggle-indicator"}))):"dropdown"===i.field.type?F.default.createElement("select",{className:"main-dropDown-dropDown",id:e,...i.field.events,onChange:e=>{r(i.field.options[e.currentTarget.selectedIndex]);const t=i.field.events?.onChange;t&&t(e)}},i.field.options.map((e,t)=>F.default.createElement("option",{selected:e===n,value:t+1},e))):F.default.createElement(F.default.Fragment,null)))}}},O=n(s());async function G(e,t){e=encodeURIComponent(e.trim()),e=await Spicetify.CosmosAsync.get(`https://api.spotify.com/v1/search?q=${e}&type=album,artist,playlist,track&limit=${t}&include_external=audio`);{t=e;const i=Object.entries(t).filter(([,e])=>0<e.items.length).map(([e,t])=>({type:e,items:t.items})).reduce((e,t)=>{switch(t.type){case"tracks":e[0]=t;break;case"artists":e[1]=t;break;case"albums":e[2]=t;break;case"playlists":e[3]=t}return e},[]),n=i.flatMap(e=>e.items);return{categorizedSuggestions:i,suggestions:n}}}var T=n(i("react"));var V=n(i("react")),Q=n(s());function X({suggestion:e,onSuggestionClick:t,selected:i}){var n="track"===e.type||"album"===e.type,s="track"===e.type?null==(s=e.album)?void 0:s.images[0].url:null==(s=null==(s=e.images)?void 0:s[0])?void 0:s.url;return V.default.createElement("li",{className:(0,Q.default)("suggestion-item",{"has-info":n,"suggestion-item__active":i}),onClick:()=>t(e.uri)},V.default.createElement("img",{src:s,alt:e.name,className:"suggestion-item__img"}),V.default.createElement("div",{className:"suggestion-item__text"},V.default.createElement("span",null,e.name),n&&V.default.createElement("span",null,null==(i=e.artists)?void 0:i.map(e=>e.name).join(", "))))}function Y({categorizedSuggestions:e,onSuggestionClick:i,selectedSuggestionUri:n}){return T.default.createElement("div",{id:"power-bar-suggestions"},T.default.createElement("div",{id:"suggestions-container"},e.map(({type:e,items:t})=>T.default.createElement("ul",{key:e,className:"suggestions-category"},T.default.createElement("h5",null,function(e){return e.charAt(0).toUpperCase()+e.slice(1)}(e)),t.map(e=>T.default.createElement(X,{key:e.id,suggestion:e,selected:e.uri===n,onSuggestionClick:i}))))))}var Z=/^[a-z0-9]$/i,ee="results-per-category",D="key-combo",te="play-immediately",ie=["Shift","Control","Alt","Meta"],ne=class extends p.default.Component{constructor(e){super(e),this.isMac="osx"===Spicetify.Platform.PlatformData.os_name,this.suggestions=[],this.searchInput=p.default.createRef(),this.previousSearchValue="",this._selectedSuggestionIndex=0,this.debouncedSearch=$(async()=>{var e=this.settings.getFieldValue(ee),{categorizedSuggestions:t,suggestions:e}=await G(null==(t=this.searchInput.current)?void 0:t.value,e);this.setState({categorizedSuggestions:t}),this.suggestions=e,this.selectedSuggestionIndex=0},300),this.onSuggestionClick=e=>{this.onSelectSuggestion(e)},this.onInput=t=>{if(!this.isActivationKeyCombo(t.nativeEvent)){const{currentTarget:i,key:n}=t;let e=i.value.trim();if(Z.test(n)&&(e+=n),"Escape"===n)i.value?(i.value="",this.clearSuggestions()):this.togglePowerBar();else{if("ArrowUp"===n)return t.preventDefault(),void this.selectedSuggestionIndex--;if("ArrowDown"===n)return t.preventDefault(),void this.selectedSuggestionIndex++;if("Enter"===n)if(this.suggestions)return t=this.suggestions[this.selectedSuggestionIndex],void this.onSelectSuggestion(t.uri);!e||e.length<2?this.clearSuggestions():e!==this.previousSearchValue&&(this.previousSearchValue=e,this.debouncedSearch())}}},this.handleSettingsInput=e=>{e.preventDefault(),e.stopPropagation();const t=e.nativeEvent["code"],i=this.settings.getFieldValue(D);switch(t){case"Backspace":this.settings.setFieldValue(D,i.slice(0,-1)),e.currentTarget.value=e.currentTarget.value.split(",").slice(0,-1).join("");break;case"Enter":case"Tab":e.currentTarget.blur();break;default:if(2<=i.length)return;var n=ie.some(e=>t.includes(e));if(0===i.length&&!n)return;n=0===i.length?t.toLowerCase().replace(/left|right/gi,"Key").replace("control","ctrl"):t;this.settings.setFieldValue(D,[...i,n]),e.currentTarget.value=e.currentTarget.value?e.currentTarget.value+","+n:n}},this.state={active:!1,categorizedSuggestions:[],selectedSuggestionUri:""},this.settings=new J("Power bar settings","power-bar-settings",{"results-per-category":{type:"dropdown",description:"Show amount of suggestions per category",defaultValue:"3",options:["1","2","3","4","5","6","7","8","9","10"]},"key-combo":{type:"input",description:"Activation key combo. First key needs to be a modifier (shift, ctrl, alt or cmd/windows key).",defaultValue:[this.isMac?"altKey":"ctrlKey","Space"],events:{onKeyDown:this.handleSettingsInput,onBlur:e=>{0===this.settings.getFieldValue(D).length&&(e.currentTarget.placeholder="Please set a valid key combo",Spicetify.showNotification("Please set a valid key combo for the power bar"))}}},"play-immediately":{type:"toggle",description:"Play suggestion on click",defaultValue:!1}}),this.settings.pushSettings()}set selectedSuggestionIndex(e){(e=-1===e?this.suggestions.length-1:e)===this.suggestions.length&&(e=0),this._selectedSuggestionIndex=e,this.setState({selectedSuggestionUri:this.suggestions[e].uri},()=>{var e=document.getElementsByClassName("suggestion-item__active")[0],t=document.getElementById("power-bar-suggestions"),i=e.getBoundingClientRect(),{top:t,bottom:n}=t.getBoundingClientRect();(i.top<t||i.bottom>n)&&e.scrollIntoView()})}get selectedSuggestionIndex(){return this._selectedSuggestionIndex}componentDidMount(){document.addEventListener("keydown",e=>{this.isActivationKeyCombo(e)&&(e.preventDefault(),this.togglePowerBar())})}onSelectSuggestion(e){this.settings.getFieldValue(te)&&Spicetify.Player.playUri(e),e=e,(e=null==(e=Spicetify.URI.from(e))?void 0:e.toURLPath(!0))&&Spicetify.Platform.History.push(e),this.togglePowerBar()}togglePowerBar(){this.setState(e=>({active:!e.active})),this.state.active&&this.searchInput.current?(this.searchInput.current.focus(),this.searchInput.current.value=""):this.clearSuggestions()}clearSuggestions(){this.setState({categorizedSuggestions:[]}),this.suggestions=[]}isActivationKeyCombo(e){var t=e.target;if("INPUT"===(null==t?void 0:t.tagName)&&"power-bar-search"!==t.id)return!1;var[t,i]=this.settings.getFieldValue(D);return!!e[t]&&e.code===i}render(){return p.default.createElement("div",{id:"power-bar-container",className:(0,O.default)({hidden:!this.state.active}),onClick:this.togglePowerBar.bind(this)},p.default.createElement("div",{id:"power-bar-wrapper",onClick:e=>e.stopPropagation()},p.default.createElement("input",{ref:this.searchInput,type:"text",id:"power-bar-search",placeholder:"Search Spotify",className:(0,O.default)({"has-suggestions":0<this.state.categorizedSuggestions.length}),onKeyDown:this.onInput}),0<this.state.categorizedSuggestions.length&&p.default.createElement(Y,{categorizedSuggestions:this.state.categorizedSuggestions,selectedSuggestionUri:this.state.selectedSuggestionUri,onSuggestionClick:this.onSuggestionClick})))}};var se=async function(){for(;null==Spicetify||!Spicetify.Platform||null==Spicetify||!Spicetify.CosmosAsync;)await new Promise(e=>setTimeout(e,100));const e=document.createElement("div");e.style.display="block",g.default.render(r.default.createElement(ne,null),e),document.body.appendChild(e)};(async()=>{await se()})()})();(async()=>{var e;document.getElementById("powerDbar")||((e=document.createElement("style")).id="powerDbar",e.textContent=String.raw`
  .settings-module__settingsContainer___e9wxn_powerDbar{display:contents}#power-bar-container{display:flex;justify-content:center;height:100%;position:absolute;width:100%;z-index:100;background-color:rgba(0,0,0,.4);--pb-border-radius:8px}#power-bar-container #power-bar-wrapper{max-width:70rem;background-color:var(--spice-tab-active);border-radius:var(--pb-border-radius);box-shadow:5px 12px 40px 0 var(--spice-shadow);height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;top:10vh;position:absolute}#power-bar-container #power-bar-search{border:none;width:700px;font-size:2em;padding:8px 16px;color:var(--spice-text);background-color:transparent}#power-bar-container #power-bar-search.has-suggestions{border-bottom:1px solid var(--spice-shadow)}#power-bar-container #power-bar-suggestions{padding:1em 0 1em 1em;max-height:70vh;overflow-y:scroll}#power-bar-container #suggestions-container{display:flex;flex-direction:column;gap:1em}#power-bar-container .suggestions-category{display:flex;flex-direction:column;gap:4px}#power-bar-container .suggestions-category:not(:last-child){padding-bottom:1em;border-bottom:1px solid var(--spice-shadow)}#power-bar-container .suggestions-category p{font-size:12px;color:var(--spice-subtext)}#power-bar-container .suggestion-item{color:var(--spice-text);display:flex;gap:1em;align-items:center;padding:4px 8px;margin-left:-8px}#power-bar-container .suggestion-item:hover{cursor:pointer}#power-bar-container .suggestion-item__img{height:2rem;width:2rem}#power-bar-container .suggestion-item__text{display:flex;flex-direction:column}#power-bar-container .suggestion-item__active{background-color:var(--spice-button);border-radius:8px}#power-bar-container .suggestion-item__active span{color:var(--spice-main)!important}#power-bar-container .suggestion-item.has-info span:nth-child(1){font-weight:700}#power-bar-container .suggestion-item.has-info span:nth-child(2){color:var(--spice-subtext);font-size:14px;margin-top:-4px}#power-bar-container .hidden{display:none!important}
      `.trim(),document.head.appendChild(e))})();